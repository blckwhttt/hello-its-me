<app-modal
  [isOpen]="isOpen"
  [customLayout]="true"
  [backdropClass]="'bg-black/60'"
  customWidth="1500px"
  customHeight="88vh"
  [customClass]="'bg-[#0f0e13] rounded-[34px] flex overflow-hidden'"
  (closed)="close()"
>
  <div slot="custom" class="flex h-full w-full">
    <!-- Sidebar -->
    <aside class="w-[290px] bg-black/15 px-3.5 border-r border-white/5 flex flex-col overflow-x-hidden relative">
      <div class="px-4 py-5.5 border-b border-white/10">
        <h2 class="text-[22px] font-semibold flex items-center gap-3 text-white/40">
          Настройки
        </h2>
      </div>

      <nav class="flex-1 mt-2 space-y-4 overflow-y-auto overflow-x-hidden custom-scrollbar">
        @for (category of categories; track category.id) {
        <div class="flex flex-col gap-0.5">
          <div class="px-4 py-2 text-xs font-medium text-white/30 uppercase tracking-wide truncate">
            {{ category.label }}
          </div>

          <div class="flex flex-col">
            @for (section of getSectionsForCategory(category.id); track section.id) {
              <a
                [routerLink]="[]"
                [queryParams]="{ section: section.route }"
                queryParamsHandling="merge"
                [class.bg-white/10]="currentSection?.id === section.id"
                [class.text-white/90]="currentSection?.id === section.id"
                [class.opacity-50]="section.disabled"
                [class.cursor-not-allowed]="section.disabled"
                [class.pointer-events-none]="section.disabled"
                class="group flex items-center gap-3 px-4 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 border border-transparent transition-all font-medium relative"
              >
                <lucide-icon
                  [img]="section.icon"
                  [size]="20"
                  class="shrink-0"
                ></lucide-icon>
                <span class="flex-1 min-w-0 truncate whitespace-nowrap">{{ section.label }}</span>
    
                @if (section.badge) {
                <span
                  class="px-2 py-0.5 text-[10px] font-bold text-white/40 bg-white/5 rounded-md uppercase tracking-wider shrink-0"
                >
                  {{ section.badge }}
                </span>
                }
              </a>
              }
          </div>
        </div>
        }
      </nav>
    </aside>

    <!-- Content Area -->
    <main class="flex-1 flex flex-col min-w-0 px-14 py-8 bg-[#0f0e13] overflow-y-auto custom-scrollbar">
      <div class="flex flex-col gap-3 mb-10">
        @if (currentSection) {
            <h3 class="text-[28px] font-bold text-white">
              {{ currentSection.title }}
            </h3>
            <p class="text-white/40 text-[15px]">
              {{ currentSection.description }}
            </p>
          } @else {
            <h3 class="text-[26px] font-bold text-white">Настройки</h3>
            <p class="text-white/40 text-base">Выберите раздел для настройки</p>
          }
      </div>
      <!-- Scrollable Content -->
      <div class="flex-1">
          @switch (currentSection?.id) {
            @case ('audio') {
              <app-settings-audio />
            }
            @case ('personalization') {
              <app-personalization-settings />
            }
            @default {
              <!-- Fallback or future sections -->
            }
          }
      </div>
      <button
          (click)="close()"
          class="absolute top-5 right-6 size-10 rounded-[14px] hover:bg-white/5 active:bg-white/10 text-white/30 hover:text-white transition-all flex items-center justify-center"
          title="Закрыть (Esc)"
          aria-label="Закрыть настройки (Escape)"
        >
          <lucide-icon [img]="X" [size]="22"></lucide-icon>
        </button>
    </main>
  </div>
</app-modal>
